!function(j){"use strict";var r="ht",W=j[r],z=W.Default,h=Math,c=h.PI,A=2*c,y=h.sin,M=h.cos,m=h.atan2,o=h.sqrt,E=h.max,b=h.floor,e=(h.round,h.ceil),Y=h.abs,d=W.Shape,P=W.Edge,q=W.List,$=W.Style,J=W.graph,f=z.getInternal(),F=f.ui(),l=null,a="__segmentLengths",t="__lineTotalLength",g="__linePoints",X="__distance0",Q="flow.count",S="flow.step",C="flow.element.max",D="flow.element.count",U="flow.element.min",B="flow.element.space",w="flow.element.autorotate",k="flow.element.background",L="flow.element.shadow.max",K="flow.element.shadow.min",T="flow.element.shadow.begincolor",R="flow.element.shadow.endcolor",N="flow.element.shadow.visible",x="flow.element.image",v="flow",Z="prototype",O=J.GraphView[Z],G=W.Data[Z],H=F.DataUI[Z],p=F.ShapeUI[Z],I=F.EdgeUI[Z],s=W.DataModel[Z],i=p._80o,u=I._80o,V=s.prepareRemove,n=I._79o,_=p._79o,ai=O.setDataModel,Rk=function(U){return document.createElement(U)};O.calculatePointLength=function(U,w,u){var E=this,B=E.getDataUI(U);u==l&&(u=.1);var e=Gp(B),T=[];if(e){for(var s=e.length,t=0;s>t;t++){var S=e[t];S._as&&(S=S._as);for(var L=S[0],V=1;V<S.length;V++)T.push([L,S[V]]),L=S[V]}for(var o=[],t=0;t<T.length;t++){var O=kq(T[t][0],T[t][1],w);o.push(O)}var A=o.slice(0);A.sort(function(_,S){return _.z>S.z?1:_.z<S.z?-1:0});var Q=A[0];if(Q.z<u){for(var M=o.indexOf(Q),H=0,t=0;M>=t;t++)H+=M>t?z.getDistance(T[t][0],T[t][1]):z.getDistance(T[t][0],Q);return H}}},z.calculatePointLength=function(H,$,y,h){h==l&&(h=.1);var g=Gp(l,H,$),$=[];if(g){for(var Z=g.length,W=0;Z>W;W++){var G=g[W];G._as&&(G=G._as);for(var s=G[0],d=1;d<G.length;d++)$.push([s,G[d]]),s=G[d]}for(var r=[],W=0;W<$.length;W++){var D=kq($[W][0],$[W][1],y);r.push(D)}var L=r.slice(0);L.sort(function(R,F){return R.z>F.z?1:R.z<F.z?-1:0});var _=L[0];if(_.z<h){for(var k=r.indexOf(_),S=0,W=0;k>=W;W++)S+=k>W?z.getDistance($[W][0],$[W][1]):z.getDistance($[W][0],_);return S}}},O.calculateClosestPoint=function(g,b){var h=this,d=h.getDataUI(g),U=Gp(d),N=[];if(U){for(var G=U.length,n=0;G>n;n++){var W=U[n];W._as&&(W=W._as);for(var j=W[0],z=1;z<W.length;z++)N.push([j,W[z]]),j=W[z]}for(var L=[],n=0;n<N.length;n++){var S=kq(N[n][0],N[n][1],b);L.push(S)}return L.sort(function(x,j){return x.z>j.z?1:x.z<j.z?-1:0}),L[0]}},z.calculateClosestPoint=function(H,t,b){var J=Gp(l,H,t),t=[];if(J){for(var D=J.length,X=0;D>X;X++){var n=J[X];n._as&&(n=n._as);for(var k=n[0],S=1;S<n.length;S++)t.push([k,n[S]]),k=n[S]}for(var V=[],X=0;X<t.length;X++){var i=kq(t[X][0],t[X][1],b);V.push(i)}return V.sort(function(L,G){return L.z>G.z?1:L.z<G.z?-1:0}),V[0]}},O.getPercentAngle=function(E,D){var c=this,T=c.getDataUI(E),Q=E.getRotation?E.getRotation():0,l=Gp(T);if(l)if(0===D){var e=l[0][0],F=l[0][1];Q+=m(F.y-e.y,F.x-e.x)}else if(100===D){l=l[l.length-1];var e=l[l.length-2],F=l[l.length-1];Q+=m(F.y-e.y,F.x-e.x)}else{for(var L=0,f=[],W=l.length,d=0;W>d;d++){var A=l[d],w=Wi(A);L+=w,f.push(w)}for(var G=L*D/100,s=yp(G,f),r=0,k=0;s>k;k++)r+=f[k];G-=r;for(var y=ph(l[s],G),I=l[s],p=0,H=0,U=0;U<I.length-1;U++){var K=I[U],S=I[U+1],b=S.x-K.x,V=S.y-K.y,N=o(b*b+V*V);if(p+=N,p>G){H=U;break}}var g=I[H];Q+=m(y.y-g.y,y.x-g.x)}return Q},z.getPercentAngle=function(q,u,D){var R=0,S=Gp(l,q,u);if(S)if(0===D){var v=S[0][0],f=S[0][1];R+=m(f.y-v.y,f.x-v.x)}else if(100===D){S=S[S.length-1];var v=S[S.length-2],f=S[S.length-1];R+=m(f.y-v.y,f.x-v.x)}else{for(var j=0,x=[],I=S.length,A=0;I>A;A++){var t=S[A],d=Wi(t);j+=d,x.push(d)}for(var U=j*D/100,h=yp(U,x),V=0,r=0;h>r;r++)V+=x[r];U-=V;for(var X=ph(S[h],U),a=S[h],e=0,y=0,L=0;L<a.length-1;L++){var n=a[L],B=a[L+1],s=B.x-n.x,F=B.y-n.y,N=o(s*s+F*F);if(e+=N,e>U){y=L;break}}var g=a[y];R+=m(X.y-g.y,X.x-g.x)}return R},O.calculateLength=function(h){var M=this,t=M.getDataUI(h),p=Gp(t),V=0;if(p)if(Array.isArray(p[0]))for(var r=p.length,R=0;r>R;R++){var s=p[R],S=Wi(s);V+=S}else V=Wi(p);return V},z.calculateLength=function(M,k){var M=Gp(l,M,k),E=0;if(M)if(Array.isArray(M[0]))for(var n=M.length,T=0;n>T;T++){var o=M[T],W=Wi(o);E+=W}else E=Wi(M);return E};var kq=z.calculateClosestPointOnLine=function(x,N,E){var d=x.x,C=x.y,m=N.x,M=N.y,h=E.x,X=E.y,c={},o=m-d,J=M-C,u=Math.sqrt(o*o+J*J),V=o/u,P=J/u,e=(-d+h)*V+(-C+X)*P;return c.x=d+e*V,c.y=C+e*P,df(c,x,N)||(c.x=Math.abs(c.x-x.x)<Math.abs(c.x-N.x)?x.x:N.x,c.y=Math.abs(c.y-x.y)<Math.abs(c.y-N.y)?x.y:N.y),o=h-c.x,J=X-c.y,c.z=Math.sqrt(o*o+J*J),c},df=function(i,Z,A){return i.x>=Math.min(Z.x,A.x)&&i.x<=Math.max(Z.x,A.x)&&i.y>=Math.min(Z.y,A.y)&&i.y<=Math.max(Z.y,A.y)},Wi=function(X){for(var Z=0,W=X.length-1,i=0;W>i;i++){var m=X[i],I=X[i+1],s=I.x-m.x,e=I.y-m.y,y=o(s*s+e*e);Z+=y}return Z},ph=function(z,Q){for(var I=0,F=0,Y=0,W=z.length-1,u=0;W>u;u++){var l=z[u],q=z[u+1],g=q.x-l.x,B=q.y-l.y;if(Y=o(g*g+B*B),I+=Y,I>Q){I-=Y,F=u;break}}var V=z[F],n=z[F+1],h=m(n.y-V.y,n.x-V.x),c=Q-I,B=y(h)*c,g=M(h)*c;return{x:V.x+g,y:V.y+B}},nn=function(d,N,f,t){var D=M(t),X=y(t),g=D*N-X*f,F=X*N+D*f;return d?{x:d.x+g,y:d.y+F}:{x:g,y:F}},Bp=function(x,i){x[a]=x[t]=x[g]=i[X]=l},jg=function(O,a,g,D,w,N){var r,h,S,E,x,U,T,V,q,P,G,Q=[];if(Y(D)>A&&(D=A),x=e(Y(D)/(c/4)),r=D/x,h=-r,S=-g,x>0){U=O+M(g)*w,T=a+y(-g)*N,Q.push({x:U,y:T});for(var J=0;x>J;J++)S+=h,E=S-h/2,V=O+M(S)*w,q=a+y(S)*N,P=O+M(E)*(w/M(h/2)),G=a+y(E)*(N/M(h/2)),Q.push({x:P,y:G}),Q.push({x:V,y:q})}return Q},Gp=function(K,S,b){if(S==l){var D=K._data;if(D instanceof d){if(S=D.getPoints(),b=D.getSegments(),(!b||0===b.size())&&S){b=new W.List([1]);for(var t=1;t<S.size();t++)b.add(2)}}else if(D instanceof P){var H=K._78o;if(H){var k=H.type,Q=H.points,O=H.segments,R=H._4O;if(!k||Q){var i=H.sourcePoint,p=i.x,_=i.y,c=H.targetPoint,C=c.x,e=c.y;if(k)O?(S=new q({x:p,y:_}),S.addAll(Q),S.add({x:C,y:e}),b=new q(O._as)):(S=new q({x:p,y:_}),b=new q([1]),Q.each(function(v){S.add(v),b.add(2)}),S.add({x:C,y:e}),b.add(2));else if(H.looped){S=new q(jg(p,_,0,A,H.radius,H.radius)),b=new q([1]);for(var t=0;t<(S.size()-1)/2;t++)b.add(3)}else S=new q,H.center?(S.add({x:H.c1.x,y:H.c1.y}),S.add({x:p,y:_}),S.add({x:C,y:e}),S.add({x:H.c2.x,y:H.c2.y}),b=new q([1,2,2,2])):(S.add({x:p,y:_}),S.add({x:C,y:e}),b=new q([1,2]))}else if(R)if(S=new q(R.points._as),R.segments)b=new q(R.segments._as);else{b=new q([1]);for(var t=1;t<R.points.size();t++)b.add(2)}}}}if(S){if(Array.isArray(S)&&(S=new q(S)),"number"==typeof S.get(0)){for(var r=new W.List,t=0;t<S.size();t+=2)r.add({x:S.get(t),y:S.get(t+1)});S=r}if(!b){b=[];for(var t=0;t<S.size();t++)0===t?b.push(1):b.push(2)}Array.isArray(b)&&(b=new q(b));for(var x=f.toPointsArray(S._as,b._as,50),X=x.length,N=[],t=0;X>t;t++){var $=x[t];$.length>1&&N.push($)}return N}},_l=function(I){var r=I._data,x=Gp(I);if(x){r.s("flow.reverse")&&(x.reverse(),x.forEach(function(w){w.reverse()}));for(var $=0,p=[],J=x.length,K=0;J>K;K++){var O=x[K],h=Wi(O);$+=h,p.push(h)}if(r[a]=p,r[t]=$,r[g]=x,r instanceof P){var A=z.unionPoint(x),i=A.x+A.width/2,v=A.y+A.height/2;r.$10e={x:i,y:v}}ze(I,!0)}},ze=(z.getPercentPositionOnPoints=function($,m,Z){if($){var p=Gp(l,$,m);if(p){var H;if(0===Z)H=p[0][0];else if(100===Z)p=p[p.length-1],H=p[p.length-1];else{for(var Y=0,D=[],a=p.length,d=0;a>d;d++){var x=p[d],o=Wi(x);Y+=o,D.push(o)}for(var R=Y*Z/100,T=yp(R,D),S=0,t=0;T>t;t++)S+=D[t];R-=S,H=ph(p[T],R)}return H}}},O.getPercentPosition=function(A,e){var f=this,M=f.getDataUI(A),R=Gp(M);if(R){var Y;if(0===e)Y=R[0][0];else if(100===e)R=R[R.length-1],Y=R[R.length-1];else{for(var Q=0,H=[],c=R.length,_=0;c>_;_++){var y=R[_],S=Wi(y);Q+=S,H.push(S)}for(var b=Q*e/100,C=yp(b,H),F=0,r=0;C>r;r++)F+=H[r];b-=F,Y=ph(R[C],b)}return Y}},function(i,W){var u=i._data,B=u[t],N=u.s(Q),R=u.s(S),z=0,n=u[a],J=u.s(C),F=u.s(U),l=u.s(D),g=(J-F)/(l-1),Y=[];if(n){if(1===l)Y.push(J);else if(2===l)Y.push(J),Y.push(F);else{if(!(l>2))return;Y.push(J);for(var h=l-2;h>0;h--)Y.push(F+g*h);Y.push(F)}var r=0,f=0;Y.forEach(function(h){l-1>r&&(f+=u.getFlowElementSpace(h)),r++}),f+=(J+F)/2,z=(B-N*f+f)/N;var x=i[X];for(null==x&&(x=0),W||(x+=R);x>B+f;){var M=i._overCount;M?M++:M=1,M>=N&&(M=null),i._overCount=M,u.s("flow.autoreverse")?M?x-=z+f:(x=0,u.s("flow.reverse",!u.s("flow.reverse"))):x-=z+f}i[X]=x}}),Rr=function(w){var A=w.data,Q=this.dm();if(A&&"add"===w.kind){var J=Q.$3e;J&&A.s(v)&&J.indexOf(A)<0&&J.push(A)}"clear"===w.kind&&(Q.$3e=[])},Ji=function(K){var L=K.property,E=K.data,d=K.newValue,D=this.dm().$3e;if(D&&"s:flow"===L)if(d)D.indexOf(E)<0&&D.push(E);else for(var h=D.length,R=0;h>R;R++)if(D[R]===E){D.splice(R,1);break}},yp=yp=function(E,B){for(var A=0,Q=B.length,F=0;Q>F;F++){var N=B[F];if(A+=N,A>E)return F}return Math.min(F,Q-1)},Tk=function(j){var v=this,I=v._data,u=I[t],r=I[a],c=I[g],Y=I.s(Q),Z=0,M=v[X],P=I.s(C),z=I.s(U),V=I.s(D),n=I.s(K),k=I.s(L),_=I.s(w),A=(k-n)/(V-1),S=(P-z)/(V-1),f=I.getRotation?I.getRotation():0,J=I.getPosition?I.p():I.$10e,p=[],x=[];if(M!=l){if(1===V)p.push(P);else if(2===V)p.push(P),p.push(z);else{if(!(V>2))return;p.push(P);for(var N=V-2;N>0;N--)p.push(z+S*N);p.push(z)}if(1===V)x.push(k);else if(2===V)x.push(k),x.push(n);else{if(!(V>2))return;x.push(k);for(var N=V-2;N>0;N--)x.push(n+A*N);x.push(n)}var e=0,G=0;p.forEach(function(w){V-1>e&&(G+=I.getFlowElementSpace(w)),e++}),G+=(P+z)/2,Z=(u-Y*G+G)/Y,j.save();for(var N=0;Y>N;N++){var F=M,d=0,s=v._overCount,W=0;I.s("flow.autoreverse")&&s&&s>Y-(N+1)||(F-=N*(Z+G),e=0,p.forEach(function(Z){var n=F-d;if(n>=0&&u>n){var k=!0,z=yp(n,r);W=0;for(var y=0;z>y;y++)W+=r[y];if(n-=W,k){var s=ph(c[z],n),T=f;if(_){for(var L=c[z],M=0,l=0,C=0;C<L.length-1;C++){var P=L[C],V=L[C+1],O=V.x-P.x,w=V.y-P.y,b=o(O*O+w*w);if(M+=b,M>n){l=C;break}}var K=L[l];T+=m(s.y-K.y,s.x-K.x)}f&&(s=nn(J,s.x-J.x,s.y-J.y,f)),v.$5e(j,s,Z,x[e],T)}}d+=I.getFlowElementSpace(p[e]),e++}))}j.restore()}},Sq=function(){var j=this,Y=j._data,h=Y.s(C),o=!1,X=l;if(j._6I||(o=!0),X=Y instanceof P?n.call(j):_.call(j),Y.s(v)&&o){var d=Y.s(L),$=Y.s(N);$&&d>h&&(h=d),h>0&&z.grow(X,e(h/2)),_l(j)}return!Y.s(v)&&o&&Bp(Y,j),X};G.getFlowElementSpace=function(){return this.s(B)},p._79o=Sq,I._79o=Sq,$[C]==l&&($[C]=7),$[U]==l&&($[U]=0),$[Q]==l&&($[Q]=1),$[S]==l&&($[S]=3),$[D]==l&&($[D]=10),$[B]==l&&($[B]=3.5),$[w]==l&&($[w]=!1),$[k]==l&&($[k]="rgba(255, 255, 114, 0.4)"),$[T]==l&&($[T]="rgba(255, 255, 0, 0.3)"),$[R]==l&&($[R]="rgba(255, 255, 0, 0)"),$[N]==l&&($[N]=1),$[L]==l&&($[L]=22),$[K]==l&&($[K]=4),s.prepareRemove=function(Y){V.call(this,Y);var Z=Y._dataModel,h=Z.$3e;if(h)for(var i=h.length,d=0;i>d;d++)if(h[d]===Y){h.splice(d,1);break}},O.setDataModel=function(s){var T=this,q=T._dataModel;if(q!==s){q&&(q.umm(Rr,T),q.umd(Ji,T),q.$3e=[]),s.mm(Rr,T),s.md(Ji,T);var n=s.$3e=[];s.each(function(s){s.s(v)&&n.indexOf(s)<0&&n.push(s)}),ai.call(T,s)}},O.setFlowInterval=function($){var W=this,K=W.$11e;W.$11e=$,W.fp("flowInterval",K,$),W.$7e!=l&&(clearInterval(W.$7e),delete W.$7e,W.enableFlow($))},O.getFlowInterval=function(){return this.$11e},O.$9e=function(){var F,$,X,g=this,s=g.tx(),T=g.ty(),w=g.getZoom(),i=g.getWidth(),P=g.getHeight(),t={x:-s/w,y:-T/w,width:i/w,height:P/w},Z=g.dm().$3e,L=g._56I,k=new q;if(Z.forEach(function(Z){L[Z.getId()]&&(F=g.getDataUI(Z),F&&(X=F._79o(),X&&k.add(X)))}),0!==k.size()&&(k.each(function(k){z.intersectsRect(t,k)&&($=z.unionRect($,k))}),$&&($&&(z.grow($,E(1,1/w)),$.x=b($.x*w)/w,$.y=b($.y*w)/w,$.width=e($.width*w)/w,$.height=e($.height*w)/w,$=z.intersection(t,$)),$))){var c=g._canvas.getContext("2d");c.save(),c.lineCap=z.lineCap,c.lineJoin=z.lineJoin,f.translateAndScale(c,s,T,w),c.beginPath(),c.rect($.x,$.y,$.width,$.height),c.clip(),c.clearRect($.x,$.y,$.width,$.height),g.$6e(c,$),c.restore()}},O.$6e=function(t,_){var I,U,k=this;k._93db(t),k.each(function(Q){k._56I[Q._id]&&(I=k.getDataUI(Q),I&&(U=I._79o(),(!_||z.intersectsRect(_,U))&&I._42(t)))}),k._92db(t)},O.enableFlow=function(O){var M=this,y=M.dm(),H=y.$3e;M.$7e==l&&(H.forEach(function(I){var s=M.getDataUI(I);_l(s)}),M.$7e=setInterval(function(){y.$3e.forEach(function(t){ze(M.getDataUI(t))}),M.$9e()},O||M.$11e||50))},O.disableFlow=function(){var e=this;clearInterval(e.$7e),delete e.$7e;var E=e.dm().$3e;E&&e.$9e()},H.$5e=function(B,u,b,U,t){var m=this,$=m._data,s=m.gv,X=$.s(k),S=$.s(T),e=$.s(R),h=$.s(N),j=s.$8e,D=$.s(x);if(j==l&&(j=s.$8e={}),B.beginPath(),D!=l){var Z=z.getImage(D),G=b/2;B.translate(u.x,u.y),B.rotate(t),B.translate(-u.x,-u.y),z.drawImage(B,Z,u.x-G,u.y-G,b,b,$),B.translate(u.x,u.y),B.rotate(-t),B.translate(-u.x,-u.y)}else B.fillStyle=X,B.arc(u.x,u.y,b/2,0,A,!0),B.fill();if(h){var Y=22,q=Y+"_"+S+"_"+e,F=j[q];if(F==l){var M=Rk("canvas");f.setCanvas(M,Y,Y);var K=M.getContext("2d"),Q=Y/2,n=Q,d=Q;f.translateAndScale(K,0,0,1),K.beginPath();var i=K.createRadialGradient(n,d,0,n,n,Q);i.addColorStop(0,S),i.addColorStop(1,e),K.fillStyle=i,K.arc(n,d,Q,0,A,!0),K.fill(),F=j[q]=M}var G=U/2;z.drawImage(B,F,u.x-G,u.y-G,U,U,$)}},I._80o=function(d){u.call(this,d);var Y=this,U=Y._data,e=Y.gv;U.s(v)&&e.$7e!=l&&Tk.call(Y,d)},p._80o=function(G){i.call(this,G);var P=this,y=P._data,d=P.gv;y.s(v)&&d.$7e!=l&&Tk.call(P,G)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);